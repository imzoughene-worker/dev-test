<div class="grid grid-cols-1 gap-4">
  <kendo-card
    width="100%"
    [formGroup]="adminService.formFilter">
    @if ((editMode$ | async) === false) {
    <kendo-card-body class="grid grid-cols-6 content-center">
      <h6
        kendoCardTitle
        class="m-0 col-span-2 flex items-center">
        Dashboard Admin - {{ getTitle | async }}
      </h6>
      <kendo-card-actions
        class="col-span-4"
        [layout]="'end'">
        <portals-auto-refresher
          class="flex items-center"
          [initialValue]="false"
          (refreshTriggered)="search()"></portals-auto-refresher>
        <div class="k-form-field">
          @if ({ val: handleDateChange | async }; as val) {
          <kendo-daterange>
            <kendo-label text="Début">
              <kendo-dateinput
                kendoDateRangeStartInput
                formControlName="startingDate"></kendo-dateinput>
            </kendo-label>
            <kendo-label text="Fin">
              <kendo-dateinput
                kendoDateRangeEndInput
                formControlName="endDate"></kendo-dateinput>
            </kendo-label>
          </kendo-daterange>
          }
        </div>
        <button
          kendoButton
          [svgIcon]="filterIcon"
          (click)="toggleFilters()"></button>
        <button
          kendoButton
          [svgIcon]="pencilIcon"
          (click)="setEditMode(true)"></button>
        <button
          kendoButton
          [fillMode]="'solid'"
          [svgIcon]="arrowRotateCwIcon"
          (click)="search()"></button>
      </kendo-card-actions>
    </kendo-card-body>
    } @else {
    <kendo-card-body class="flex justify-center gap-2 items-center">
      <span
        kendoCardSubtitle
        class="m-0">
        Déplacez ou redimensionnez vos widgets, puis terminez la modification.</span
      >
      <button
        kendoButton
        (click)="setEditMode(false)"
        [themeColor]="'primary'">
        Terminer la modification
      </button>
    </kendo-card-body>
    } @if (filterOpen$ | async) {
    <kendo-card-footer class="flex flex-nowrap justify-between gap-4 items-center">
      <div class="flex gap-4">
        <portals-dashboard-search-field
          class="flex items-center min-w-[250px]"
          [field]="souscripteurField"></portals-dashboard-search-field>
        <span class="margin-filter">
          Filtrer sur Aujourd'hui
          <kendo-switch
            [checked]="(adminService.filterForToday | async) ?? false"
            (valueChange)="adminService.filterForToday.next($event)">
          </kendo-switch>
        </span>
        @if(trigramme.authority === 'AZM') {
        <span class="margin-filter flex items-center gap-2">
          <div>
            Dossiers NextCare
            <kendo-svgicon
              kendoTooltip
              title="Activer ce filtre pour afficher uniquement les données liées à Nextcare."
              [icon]="infoCircleIcon"></kendo-svgicon>
          </div>
          <kendo-switch
            [checked]="(adminService.filterByNextcare | async) ?? false"
            (valueChange)="adminService.filterByNextcare.next($event)">
          </kendo-switch>
        </span>
        }
      </div>
      <kendo-card-actions
        [layout]="'end'"
        class="">
        <button
          kendoButton
          (click)="reset()">
          Réinitialiser
        </button>
        <button
          kendoButton
          (click)="search()">
          Appliquer
        </button>
      </kendo-card-actions>
    </kendo-card-footer>
    }
  </kendo-card>

  <div [hidden]="(adminService.adminFilters$ | async) === null">
    <router-outlet (activate)="onOutletLoaded($event, editModeSignal())"></router-outlet>
  </div>
</div>
