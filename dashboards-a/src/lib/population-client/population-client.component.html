<div class="grid grid-cols-1 gap-4">
  <kendo-card
    width="100%"
    [formGroup]="populationClientService.formFilter">
    @if ((editMode$ | async) === false) {
      <kendo-card-body
        class="grid grid-cols-6 content-center">
        <h6
          kendoCardTitle
          class="m-0 col-span-2 flex items-center">
          Dashboard Population Clients - {{ getTitle | async }}
        </h6>
        <kendo-card-actions
          class="col-span-4"
          [layout]="'end'">
          <portals-auto-refresher
            class="flex items-center"
            [initialValue]="false"
            (refreshTriggered)="search()"></portals-auto-refresher>
          <div class="k-form-field">
            @if ({ val: handleDateChange | async }; as val) {
              <kendo-daterange>
                <kendo-label text="Début">
                  <kendo-dateinput
                    kendoDateRangeStartInput
                    formControlName="startingDate"></kendo-dateinput>
                </kendo-label>
                <kendo-label text="Fin">
                  <kendo-dateinput
                    kendoDateRangeEndInput
                    formControlName="endDate"></kendo-dateinput>
                </kendo-label>
              </kendo-daterange>
            }
          </div>
          <button
            kendoButton
            [svgIcon]="filterIcon"
          (click)="toggleFilters()"></button>
          <button
            kendoButton
            [svgIcon]="pencilIcon"
            (click)="setEditMode(true)"></button>
          <button
            kendoButton
            [fillMode]="'solid'"
            [svgIcon]="arrowRotateCwIcon"
            (click)="search()"></button>
        </kendo-card-actions>
      </kendo-card-body>
    } @else {
      <kendo-card-body class="flex justify-center gap-2 items-center">
        <span
          kendoCardSubtitle
          class="m-0">
          Déplacez ou redimensionnez vos widgets, puis terminez la modification.</span
        >
        <button
          kendoButton
          (click)="setEditMode(false)"
          [themeColor]="'primary'">
          Terminer la modification
        </button>
      </kendo-card-body>
    }
    @if (filterOpen$ | async) {
      <kendo-card-footer
        class="flex flex-nowrap justify-between gap-4 items-center"
      >
        <div class="flex flex-wrap gap-4">
          <portals-dashboard-search-field
            class="col-span-5 min-w-[250px]"
            [field]="souscripteurField"></portals-dashboard-search-field>
          <portals-dashboard-search-field
            class="col-span-3 min-w-[250px]"
            [field]="policeField"></portals-dashboard-search-field>
          <portals-dashboard-search-field
            class="col-span-2 min-w-[250px]"
            [field]="statusField"></portals-dashboard-search-field>
          <portals-dashboard-search-field
            class="col-span-4 min-w-[250px]"
            [field]="numeroAdhesionField"></portals-dashboard-search-field>
          <portals-dashboard-search-field
            class="col-span-3 min-w-[250px]"
            [field]="anneeAdhesionField"></portals-dashboard-search-field>
          <portals-dashboard-search-field
            class="col-span-3 min-w-[250px]"
            [field]="trimestreAdhesionField"></portals-dashboard-search-field>
        </div>
        <kendo-card-actions
          [layout]="'end'"
          class="">
          <button
            kendoButton
            (click)="reset()">
            Réinitialiser
          </button>
          <button
            kendoButton
            (click)="search()">
            Appliquer
          </button>
        </kendo-card-actions>
      </kendo-card-footer>
    }
  </kendo-card>

  <div [hidden]="(populationClientService.affiliationFilters$ | async) === null">
    <router-outlet (activate)="onOutletLoaded($event)"></router-outlet>
  </div>
</div>
