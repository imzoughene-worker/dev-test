<div class="grid grid-cols-1 gap-4">
  <kendo-card
    width="100%"
    [formGroup]="suiviEncaissementCieService.formFilter">
    @if ((editMode$ | async) === false) {
    <kendo-card-body class="grid grid-cols-6 content-center">
      <h6
        kendoCardTitle
        class="m-0 col-span-2 flex items-center">
        Dashboard Suivi Encaissement Cie - {{ getTitle | async }}
      </h6>
      <kendo-card-actions
        class="col-span-4"
        [layout]="'end'">
        <portals-auto-refresher
          [initialValue]="false"
          (refreshTriggered)="search()"></portals-auto-refresher>
        <div class="k-form-field">
          @if ({ val: handleDateChange | async }; as val) {
          <kendo-daterange>
            <kendo-label text="Début">
              <kendo-dateinput
                kendoDateRangeStartInput
                formControlName="startingDate"></kendo-dateinput>
            </kendo-label>
            <kendo-label text="Fin">
              <kendo-dateinput
                kendoDateRangeEndInput
                formControlName="endDate"></kendo-dateinput>
            </kendo-label>
          </kendo-daterange>
          }
        </div>
        <button
          kendoButton
          [svgIcon]="filterIcon"
          (click)="toggleFilters()"></button>
        <button
          kendoButton
          [svgIcon]="pencilIcon"
          (click)="setEditMode(true)"></button>
        <button
          kendoButton
          [fillMode]="'solid'"
          [svgIcon]="arrowRotateCwIcon"
          (click)="search()"></button>
      </kendo-card-actions>
    </kendo-card-body>
    } @else {
    <kendo-card-body class="flex justify-center gap-2 items-center">
      <span
        kendoCardSubtitle
        class="m-0">
        Déplacez ou redimensionnez vos widgets, puis terminez la modification.</span
      >
      <button
        kendoButton
        (click)="setEditMode(false)"
        [themeColor]="'primary'">
        Terminer la modification
      </button>
    </kendo-card-body>
    } @if (filterOpen$ | async) {
    <kendo-card-footer class="flex flex-nowrap justify-between gap-4 items-center">
      <div class="flex gap-4 items-center flex-wrap">
        <portals-dashboard-search-field
          class="min-w-[250px]"
          [field]="souscripteurField"></portals-dashboard-search-field>
        <portals-dashboard-search-field
          class="min-w-[250px]"
          [field]="cieField"></portals-dashboard-search-field>
        <portals-dashboard-search-field
          class="min-w-[250px]"
          [field]="numeroCvField"></portals-dashboard-search-field>
        <portals-dashboard-search-field
          class="min-w-[250px]"
          [field]="statusField"></portals-dashboard-search-field>
        <portals-dashboard-search-field
          class="min-w-[250px]"
          [field]="typeEncaissementField"></portals-dashboard-search-field>
        <div class="flex flex-col gap-1 min-w-[250px]">
          <span class="text-xs font-medium text-slate-600">Filtrer sur Aujourd'hui</span>
          <kendo-switch
            [checked]="(suiviEncaissementCieService.filterForToday | async) ?? false"
            (valueChange)="suiviEncaissementCieService.filterForToday.next($event)">
          </kendo-switch>
        </div>
        @if(trigramme.authority === 'AZM') {
        <div class="flex flex-col gap-1 min-w-[250px]">
          <span class="text-xs font-medium text-slate-600">
            Dossiers NextCare
            <kendo-svgicon
              kendoTooltip
              title="Activer ce filtre pour afficher uniquement les données liées à Nextcare."
              [icon]="infoCircleIcon"></kendo-svgicon>
          </span>
          <kendo-switch
            [checked]="(suiviEncaissementCieService.filterByNextcare | async) ?? false"
            (valueChange)="suiviEncaissementCieService.filterByNextcare.next($event)">
          </kendo-switch>
        </div>
        } @else {
        <div class="flex  flex-col gap-1">
          <span class="text-xs font-medium text-slate-600">Mode régleur</span>
          <kendo-buttongroup selection="single">
            <button
              kendoButton
              [toggleable]="true"
              fillMode="outline"
              [selected]="modeRegleur() === undefined"
              (click)="uiStore.setModeRegleur(undefined)"
              themeColor="primary">
              Général
            </button>
            <button
              kendoButton
              [toggleable]="true"
              fillMode="outline"
              [selected]="modeRegleur() === false"
              (click)="uiStore.setModeRegleur(false)"
              themeColor="primary">
              Intermédiaire
            </button>
            <button
              kendoButton
              [toggleable]="true"
              fillMode="outline"
              [selected]="modeRegleur() === true"
              (click)="uiStore.setModeRegleur(true)"
              themeColor="primary">
              Compagnie
            </button>
          </kendo-buttongroup>
        </div>
        }
      </div>
      <kendo-card-actions
        class=""
        [layout]="'end'">
        <button
          kendoButton
          (click)="reset()">
          Réinitialiser
        </button>
        <button
          kendoButton
          (click)="search()">
          Appliquer
        </button>
      </kendo-card-actions>
    </kendo-card-footer>
    }
  </kendo-card>
  <router-outlet (activate)="onOutletLoaded($event, editModeSignal())"></router-outlet>
</div>
